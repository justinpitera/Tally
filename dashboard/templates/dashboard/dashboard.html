{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static '/dashboard/css/styles.css' %}">
<script src="{% static '/dashboard/js/scripts.js' %}"></script>
    <div class="card text-center">
      <div class="card-header">
        Welcome to Tally, {{user.username}}
        <button type="button" class="close" aria-label="Close" style="float: right;">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="card-body">
        <h5 class="card-title">Getting started:</h5>
        <p class="card-text">Begin by exploring our introductory course</p>
        <a href="#" class="btn btn-primary" style="background-color:#4b4276 !important; border-style:none;" >Begin Now</a>
      </div>
    </div>

<div class="container mt-4">
    <!-- Grades Card -->
    <div class="card card-style">
        <div class="card-body">
            <h4 class="card-title">Grades</h4>
            <!-- Grades container with flexbox -->
            <div class="grades-container" style="display: flex; flex-wrap: wrap; justify-content: flex-start;">
                <!-- Overall grade container -->
                <div class="grade-item" style="flex: 0 1 22%; margin: 1%; text-align: center;">
                  <h6 style="text-align: left; margin-left: 10px;"><b>Overall:</b></h6>
                  {% if overall_average_grade %}
                  <div class="progress blue" data-grade="{{ overall_average_grade|floatformat:"2"}}">
                    <span class="progress-left">
                      <span class="progress-bar"></span>
                    </span>
                    <span class="progress-right">
                      <span class="progress-bar"></span>
                    </span>
                    <div class="progress-value"></div>
                    </div>
                  </div>

                  {% else %}

                  {% endif %}


                <!-- Dynamically generated course grades -->
                {% for course_grade in average_grades_per_course %}
                <div class="grade-item" style="flex: 0 1 22%; margin: 1%; text-align: center;">
                    <h6 style="text-align: left; margin-left: 10px;">{{course_grade.course_name}}:</h6>
                    <div class="progress blue" data-grade="{{course_grade.average_grade|floatformat:2}}">
                        <span class="progress-left">
                            <span class="progress-bar"></span>
                        </span>
                        <span class="progress-right">
                            <span class="progress-bar"></span>
                        </span>
                        <div class="progress-value"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Placeholder for dynamic URL generation (not using due to dynamic nature) -->
<script type="text/javascript">
  function getMarkAsReadUrl(notificationId) {
      // Construct the URL manually or use a base URL and append the notification ID
      return "/notifications/mark-as-read/" + notificationId + "/";
  }
  </script>
  
  <div id="customContextMenu" style="display: none; position: absolute; z-index: 1000;" class="custom-menu">
    <ul>
      <li><a id="feedBackLink" href="#">View Feedback</a></li>
      <li><a id="markReadLink" href="#">Mark as read</a></li>
    </ul>
  </div>
  
  <!-- Your existing scripts for handling the custom context menu -->
  <script>

  </script>
    <!-- Notifications Card -->
    <div class="card card-style">
      <div class="card-body">
          <h4 class="card-title">Notifications</h4>
          {% if grade_notifications %}
          {% for notification in grade_notifications %}
          <div class="list-group" id="customContextMenuTrigger">
            <a href="{% url 'view_assignment' notification.assignment.id %}?tab=section3" class="list-group-item list-group-item-action flex-column align-items-start" data-notification-id="{{ notification.id }}">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">New grade posted for {{notification.course.title}}</h5>
                <small>{{ notification.timestamp|date:"Y-m-d H:i" }}</small>
              </div>
              <p class="mb-1">Hey there! Just wanted to let you know that your assignment, "{{notification.assignment.name}}," has been reviewed and graded.
              </p>
              <small>To view your feedback, click <b>here</b></small>
            </a>
          </div>
          {%endfor%}
        {% else %}
          <p>No new notifications...</p>
        {% endif %}
          
      </div>
  </div>

    <!-- Assignments Card -->
    <div class="card card-style">
        <div class="card-body">
            <h4 class="card-title">Assignments</h4>
            <div>
                <div class="tab active-tab" onclick="showAvailable()">Available</div>
                <div class="tab" onclick="showUpcoming()">Upcoming</div>
            </div>
            <div id="availableAssignments" class="tab-content">
              {% for assignment in available_assignments %}
                <li>{{assignment.course.title}} -{{ assignment.name }} - Due: {{ assignment.end_date }}</li>
              {% empty %}
                <li>No assignments available.</li>
              {% endfor %}
            </div>
            <div id="upcomingAssignments" class="tab-content" style="display:none;">
              {% for assignment in upcoming_assignments %}
                <li>{{ assignment.name }} - Starts: {{ assignment.start_date }}</li>
              {% empty %}
                <li>No upcoming assignments.</li>
              {% endfor %}
            </div>
        </div>
    </div>
</div>



  
    
{% endblock %}
